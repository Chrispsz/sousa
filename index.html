<!DOCTYPE html>
<html>
<head>
    <title>Shaka Player HLS</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background: #000;
        }
        #video-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .shaka-controls-container {
            opacity: 0;
            transition: opacity 0.3s;
        }
        .shaka-controls-container:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video" autoplay controls></video>
    </div>

    <!-- Shaka Player -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.6/shaka-player.compiled.js"></script>
    <script>
        // URL do vídeo
        const manifestUri = 'https://live-ak.vimeocdn.com/exp=1743365863~acl=%2F1f08be1d-e8c0-4229-9585-e3b82dea5779_fmp4%2F%2A~hmac=d77bd5718326f2cf720631820ad83952e2ae2bfc1cb273c2a501c1f3686b24dc/1f08be1d-e8c0-4229-9585-e3b82dea5779_fmp4/hls.m3u8';
        
        function initApp() {
            // Instalar polyfills
            shaka.polyfill.installAll();
            
            // Verificar se o navegador é compatível
            if (shaka.Player.isBrowserSupported()) {
                // Inicializar o player
                initPlayer();
            } else {
                console.error('Navegador não suportado!');
            }
        }
        
        async function initPlayer() {
            // Obter referência ao elemento de vídeo
            const video = document.getElementById('video');
            
            // Criar uma instância do player
            const player = new shaka.Player(video);
            
            // Configurações avançadas para melhor desempenho
            player.configure({
                streaming: {
                    bufferingGoal: 60,  // Buffer maior para streaming estável
                    rebufferingGoal: 15,
                    bufferBehind: 30,
                    retryParameters: {
                        maxAttempts: 6,
                        baseDelay: 1000,
                        backoffFactor: 2,
                        fuzzFactor: 0.5
                    },
                    // Configurações para redes instáveis
                    stallEnabled: true,
                    stallThreshold: 1,
                    stallSkip: 0.1,
                    // Qualidade de vídeo
                    abr: {
                        enabled: true,
                        defaultBandwidthEstimate: 1000000, // 1Mbps inicial
                        switchInterval: 8,
                        bandwidthDowngradeTarget: 0.95,
                        bandwidthUpgradeTarget: 0.85
                    }
                }
            });
            
            // Adicionar manipulador de eventos para erros
            player.addEventListener('error', onErrorEvent);
            
            // Tentar carregar o manifesto
            try {
                await player.load(manifestUri);
                console.log('O vídeo foi carregado com sucesso');
                
                // Tentar entrar em tela cheia após o carregamento
                if (video.requestFullscreen) {
                    video.requestFullscreen();
                } else if (video.webkitRequestFullscreen) {
                    video.webkitRequestFullscreen();
                } else if (video.msRequestFullscreen) {
                    video.msRequestFullscreen();
                }
            } catch (e) {
                // Registrar qualquer erro
                onError(e);
            }
            
            // Adicionar evento para iniciar reprodução com interação do usuário
            document.addEventListener('click', function() {
                if (video.paused) {
                    video.play();
                }
            });
        }
        
        function onErrorEvent(event) {
            // Extrair o erro do evento
            onError(event.detail);
        }
        
        function onError(error) {
            // Registrar o erro e mensagem
            console.error('Erro:', error);
        }
        
        // Verificar se o documento já foi carregado
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
